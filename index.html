<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fantacalcio - Asta</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(90deg, #2f97f2, #6ac1ff);
  margin: 0;
  padding: 15px;
}

h1 {
  text-align: center;
  font-size: 28px;
  color: white;
  padding: 15px 0;
  border-radius: 12px;
  margin-bottom: 25px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.header {
  position: sticky;
  top: 0;
  display: flex;
  justify-content: space-around;
  flex-wrap: wrap;
  margin-bottom: 15px;
  text-align: center;
  gap: 15px;
  padding: 10px 0;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  backdrop-filter: blur(10px);
  z-index: 100;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.header div {
  font-size: 16px;
  width: 350px;
  background: linear-gradient(145deg, #ffffff, #e0f0ff);
  padding: 12px 15px;
  border-radius: 20px;
  box-shadow: 0 6px 12px rgba(0,0,0,0.1);
  font-weight: bold;
  transition: transform 0.3s, box-shadow 0.3s;
}

.header div.animate {
  animation: scaleGlow 0.4s ease forwards;
}

@keyframes scaleGlow {
  0% { transform: scale(1); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
  50% { transform: scale(1.2); box-shadow: 0 10px 25px rgba(47,151,242,0.6); }
  100% { transform: scale(1); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
}

.category {
  margin-bottom: 25px;
  border-radius: 15px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  /* padding: 10px; */
  background: white;
  transition: transform 0.3s, box-shadow 0.3s;
}
.category:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.category h2 {
  font-size: 20px;
  color: white;
  text-align: center;
  padding: 12px;
  border-radius: 12px 12px 0 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.portieri h2 { background: orange; }
.difensori h2 { background: rgb(0, 128, 0); }
.centrocampisti h2 { background: blue; }
.attaccanti h2 { background: red; }

table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 10px;
  border-radius: 8px;
  overflow: hidden;
}

th, td {
  padding: 10px;
  text-align: left;
  font-size: 14px;
}

tr:hover { background: #f9f9f9; transition: background 0.2s; }

input {
  border: none;
  width: 80%;
  padding: 8px 10px;
  font-size: 14px;
  border-radius: 8px;
  background: #f0f2f5;
  transition: all 0.2s;
}
input:focus {
  outline: none;
  background: #e4f0ff;
  box-shadow: 0 0 5px rgba(47,151,242,0.5);
}

.tot-reparto {
  text-align:center;
  font-weight:bold;
  background: #f1f1f1;
  padding: 8px;
  /* border-radius: 10px; */
  /* margin-top: 8px; */
  font-size:15px;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
  transition: background 0.3s;
}

button {
  display:block;
  margin: 0 auto 25px auto;
  padding:12px 25px;
  font-size:16px;
  background:#2f97f2;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
  transition: background 0.3s, transform 0.2s;
}
button:hover { background:#1f80d2; transform: translateY(-2px); }

@media(max-width:600px){
  .header{flex-direction:column; align-items:center;}
  th, td{padding:8px;}
  input{font-size:13px; padding:6px;}
}
</style>
</head>
<body>

<h1>Asta Fantacalcio</h1>

<div class="header">
  <div><b>BUDGET INIZIALE:</b> <span id="budgetIniziale">1000</span></div>
  <div><b>TOTALE SPESO:</b> <span id="totaleSpeso">0</span></div>
  <div><b>CREDITI RIMASTI:</b> <span id="creditiRimasti">1000</span></div>
</div>

<button onclick="scaricaDati()">ðŸ’¾ Salva e Scarica CSV</button>

<script>
const budgetIniziale = 1000;
const reparti = [
  {nome:"PORTIERI", id:"portieri", n:3, icona:"fas fa-hand-paper"},
  {nome:"DIFENSORI", id:"difensori", n:8, icona:"fas fa-shield-alt"},
  {nome:"CENTROCAMPISTI", id:"centrocampisti", n:8, icona:"fas fa-futbol"},
  {nome:"ATTACCANTI", id:"attaccanti", n:6, icona:"fas fa-bolt"}
];

// Genera tabelle
function generaTabella(r){
  document.write(`<div class="category ${r.id}">`);
  document.write(`<h2><i class="${r.icona}"></i> ${r.nome}</h2>`); // intestazione card esterna
  document.write(`<table><thead><tr><th>#</th><th>Nome</th><th>Prezzo</th></tr></thead>`);
  document.write(`<tbody id="${r.id}">`);
  for(let i=1;i<=r.n;i++){
    document.write(`<tr><td>${i}.</td><td><input type="text" placeholder="Nome"></td>`);
    document.write(`<td><input type="number" class="prezzo" value="" min="0"></td></tr>`);
  }
  document.write(`</tbody></table>`);
  document.write(`<div class="tot-reparto" id="tot-${r.id}">Totale ${r.nome}: 0</div>`);
  document.write(`</div>`);
}
reparti.forEach(generaTabella);

// Aggiorna budget e totali
function aggiornaBudget(){
  let totaleGenerale=0;
  reparti.forEach(r=>{
    let tot=0;
    document.querySelectorAll(`#${r.id} .prezzo`).forEach(i=>{
      let v=parseInt(i.value);
      if(!isNaN(v)) tot+=v;
    });
    const divTot = document.getElementById(`tot-${r.id}`);
    divTot.innerText = `Totale ${r.nome}: ${tot}`;
    // cambio colore se budget reparto alto
    if(tot>budgetIniziale*0.5) divTot.style.background="#ffd8d8"; 
    else divTot.style.background="#f1f1f1";
    totaleGenerale+=tot;
  });
  document.getElementById("totaleSpeso").innerText=totaleGenerale;
  document.getElementById("creditiRimasti").innerText=budgetIniziale-totaleGenerale;
  salvaDati();
}

function animaValore(id){
  const el = document.getElementById(id);
  el.classList.remove("animate");
  void el.offsetWidth; // forza reflow
  el.classList.add("animate");
}

function aggiornaBudget(){
  let totaleGenerale=0;
  reparti.forEach(r=>{
    let tot=0;
    document.querySelectorAll(`#${r.id} .prezzo`).forEach(i=>{
      let v=parseInt(i.value);
      if(!isNaN(v)) tot+=v;
    });
    const divTot = document.getElementById(`tot-${r.id}`);
    divTot.innerText = `Totale ${r.nome}: ${tot}`;
    if(tot>budgetIniziale*0.5) divTot.style.background="#ffd8d8"; 
    else divTot.style.background="#f1f1f1";
    totaleGenerale+=tot;
  });
  const totaleEl = document.getElementById("totaleSpeso");
  const creditiEl = document.getElementById("creditiRimasti");
  totaleEl.innerText=totaleGenerale;
  creditiEl.innerText=budgetIniziale-totaleGenerale;

  // animazioni
  animaValore("totaleSpeso");
  animaValore("creditiRimasti");
    salvaDati();
}

// Salvataggio su localStorage
function salvaDati(){
  const dati={};
  reparti.forEach(r=>{
    dati[r.id]=[];
    document.querySelectorAll(`#${r.id} tr`).forEach(tr=>{
      const nome=tr.querySelector("td:nth-child(2) input").value;
      const prezzo=tr.querySelector("td:nth-child(3) input").value;
      dati[r.id].push({nome, prezzo});
    });
  });
  localStorage.setItem("fantacalcio", JSON.stringify(dati));
}

// Recupero dati da localStorage
function caricaDati(){
  const dati=JSON.parse(localStorage.getItem("fantacalcio"));
  if(!dati) return;
  reparti.forEach(r=>{
    const rows = document.querySelectorAll(`#${r.id} tr`);
    rows.forEach((tr,i)=>{
      if(dati[r.id][i]){
        tr.querySelector("td:nth-child(2) input").value=dati[r.id][i].nome;
        tr.querySelector("td:nth-child(3) input").value=dati[r.id][i].prezzo;
      }
    });
  });
  aggiornaBudget();
}

// Scarica CSV
function scaricaDati(){
  let csv="Reparto,Numero,Nome,Prezzo\n";
  reparti.forEach(r=>{
    document.querySelectorAll(`#${r.id} tr`).forEach((tr,i)=>{
      const nome=tr.querySelector("td:nth-child(2) input").value.replace(/,/g,'');
      const prezzo=tr.querySelector("td:nth-child(3) input").value;
      csv+=`${r.nome},${i+1},${nome},${prezzo}\n`;
    });
  });
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download="fantacalcio.csv";
  a.click();
}

document.addEventListener("input", e=>{
  if(e.target.classList.contains("prezzo") || e.target.tagName=="INPUT") aggiornaBudget();
});

window.onload=caricaDati;
</script>

</body>
</html>
