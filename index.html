<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Fantacalcio Budget Tool</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(
          135deg,
          #0b3d0b,
          #136a13,
          #1f8a1f,
          #38c138,
          #a3f7a3
        );

        color: #333;
        margin: 0;
        padding: 15px;
        min-height: 100vh;
        font-size: 16px;
        line-height: 1.4;
      }
      .title-div {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
        background-color: white;
        border-radius: 12px;
      }

      h1.title {
        text-align: center;
        font-size: 28px;
        font-weight: 700;
        color: #2e8b57; 
        margin-bottom: 20px;
        padding: 10px 20px;
        border-radius: 12px;
      }

      .header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
        position: relative;
      }
      .stat-box {
        text-align: center;
        position: relative;
      }
      .stat-box i {
        font-size: 28px;
        color: #2e8b57;
        margin-bottom: 8px;
        display: block;
      }
      .stat-box div:not(.stat-value) {
        font-size: 14px;
        margin-bottom: 5px;
        color: #666;
      }
      .stat-value {
        font-weight: bold;
        font-size: 22px;
        color: #2e8b57;
      }
      .budget-counter {
        text-align: center;
        color: white;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 16px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
      }
      .budget-panel {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        position: relative;
      }
      .budget-input {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        padding: 10px;
        margin: 5px;
        border-radius: 12px;
        background: #f8f9fa;
        position: relative;
      }
      .budget-input i {
        font-size: 24px;
        color: #2e8b57;
      }
      .budget-input input {
        width: 80px;
        padding: 10px 5px;
        text-align: center;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        background: white;
      }
      .budget-input input:focus {
        border-color: #2e8b57;
        outline: none;
        box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
      }
      .category {
        background: white;
        border-radius: 16px;
        margin-bottom: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        padding: 0px;
      }

      .category-title {
        padding: 12px 15px;
        font-size: 18px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        gap: 10px;
        color: white;
        margin: 0;
      }

      /* Colori diversi per ogni categoria */
      .title-portieri {
        background: orange;
      }
      .title-difensori {
        background: rgb(13, 255, 0);
      }
      .title-centrocampisti {
        background: blue;
      }
      .title-attaccanti {
        background: red;
      }

      .table-container {
        overflow-x: auto;
        margin-bottom: 15px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 100%;
      }
      th,
      td {
        padding: 12px 8px;
        border-bottom: 1px solid #e9ecef;
        text-align: left;
      }
      th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
        font-size: 14px;
      }
      td:first-child {
        width: 40px;
        text-align: center;
        font-weight: bold;
        color: #6c757d;
      }
      .player-input {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        font-size: 16px;
        background: white;
      }
      .player-input:focus {
        border-color: #2e8b57;
        outline: none;
        box-shadow: 0 0 0 2px rgba(46, 139, 87, 0.1);
      }
      .price-input {
        width: 80px;
        padding: 10px 8px;
        text-align: center;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        background: white;
      }
      .price-input:focus {
        border-color: #2e8b57;
        outline: none;
        box-shadow: 0 0 0 2px rgba(46, 139, 87, 0.1);
      }
      .remove-player-btn {
        background: transparent;
        border: none;
        color: #dc3545;
        font-size: 20px;
        cursor: pointer;
        padding: 8px;
        border-radius: 6px;
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .remove-player-btn:active {
        background: rgba(220, 53, 69, 0.1);
      }
      .tot-reparto {
        font-weight: bold;
        margin-top: 12px;
        padding: 12px 16px;
        display: block;
        text-align: center;
        font-size: 16px;
      }
      .budget-info {
        font-size: 14px;
        justify-content: center;
        display: flex;
        align-items: center;
        padding: 10px 12px;
        font-weight: bold;
        background: #f8f9fa;
        text-align: center;
      }
      .verde {
        background: #d4edda;
        color: #155724;
      }
      .giallo {
        background: #fff3cd;
        color: #856404;
      }
      .rosso {
        background: #f8d7da;
        color: #721c24;
      }
      .blu {
        background: #d1ecf1;
        color: #0c5460;
      }
      /* discreti edit buttons */
      .edit-btn {
        border: none;
        background: none;
        color: #09bd57;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2px;
      }
      .edit-btn:active {
        opacity: 0.6;
      }
      #budgetTotaleSelect {
        width: 100px;
        padding: 8px 10px;
        border-radius: 12px;
        border: 2px solid #2e8b57;
        background: linear-gradient(135deg, #38c138, #1f8a1f);
        font-weight: bold;
        font-size: 15px;
        text-align: center;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease-in-out;
        background-image: url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 24 24' fill='white' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 12px;
      }

      #budgetTotaleSelect:focus {
        border-color: #38c138;
        box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.3);
        outline: none;
      }

      #budgetTotaleSelect option {
        background: white;
        color: #333;
        padding: 8px 12px;
      }
    </style>
  </head>
  <body>
    <div class="title-div">
      <h1 class="title">Fantacalcio Budget Tool</h1>
    </div>
    <div class="header">
      <div class="stat-box">
        <i class="fa-solid fa-wallet" style="color: black"></i>
        <div>Totale Budget</div>
        <select id="budgetTotaleSelect">
          <option value="500">500</option>
          <option value="750">750</option>
          <option value="1000" selected>1000</option>
        </select>
      </div>
      <div class="stat-box">
        <i class="fa-solid fa-coins" style="color: goldenrod"></i>
        <div>Rimanente</div>
        <div id="budgetRimanente" class="stat-value">1000</div>
      </div>
    </div>

    <div class="budget-counter" id="budgetRipartito">
      Ripartizione: 1000 / 1000
    </div>

    <div class="budget-panel">
      <button
        id="editRepartiBtn"
        class="edit-btn"
        style="
          position: absolute;
          top: 6px;
          right: 6px;
          font-size: 18px;
          z-index: 1000;
        "
      >
        <i class="fas fa-pencil-alt"></i>
      </button>

      <div class="budget-input">
        <i class="fas fa-hand-paper" style="color: orange"></i>
        <div style="font-size: 12px; color: #666; margin-top: 3px">
          Portieri
        </div>
        <input
          type="number"
          id="budget-portieri"
          value="100"
          min="0"
          disabled
        />
      </div>
      <div class="budget-input">
        <i class="fas fa-shield-alt" style="color: rgb(13, 255, 0)"></i>
        <div style="font-size: 12px; color: #666; margin-top: 4px">
          Difensori
        </div>
        <input
          type="number"
          id="budget-difensori"
          value="300"
          min="0"
          disabled
        />
      </div>
      <div class="budget-input">
        <i class="fas fa-futbol" style="color: #007bff"></i>
        <div style="font-size: 12px; color: #666; margin-top: 4px">
          Centrocampisti
        </div>
        <input
          type="number"
          id="budget-centrocampisti"
          value="400"
          min="0"
          disabled
        />
      </div>
      <div class="budget-input">
        <i class="fas fa-bolt" style="color: red"></i>
        <div style="font-size: 12px; color: #666; margin-top: 4px">
          Attaccanti
        </div>
        <input
          type="number"
          id="budget-attaccanti"
          value="200"
          min="0"
          disabled
        />
      </div>
    </div>

    <script>
      let budgetIniziale = 1000;

      const reparti = [
        {
          nome: "PORTIERI",
          id: "portieri",
          n: 3,
          icona: "fas fa-hand-paper",
          budget: 100,
        },
        {
          nome: "DIFENSORI",
          id: "difensori",
          n: 8,
          icona: "fas fa-shield-alt",
          budget: 300,
        },
        {
          nome: "CENTROCAMPISTI",
          id: "centrocampisti",
          n: 8,
          icona: "fas fa-futbol",
          budget: 400,
        },
        {
          nome: "ATTACCANTI",
          id: "attaccanti",
          n: 6,
          icona: "fas fa-bolt",
          budget: 200,
        },
      ];

      function generaTabelle() {
        reparti.forEach((r) => {
          const container = document.createElement("div");
          container.className = `category ${r.id}`;
          container.style.overflow = "hidden"; // così border-radius funziona sull'h2
          container.innerHTML = `
  <h2 class="category-title title-${r.id}">
    <i class="${r.icona}"></i> ${r.nome}
  </h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Nome Giocatore</th>
          <th>Prezzo</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="${r.id}"></tbody>
    </table>
  </div>
  <div class="tot-reparto verde" id="tot-${r.id}">
    Totale ${r.nome}: 0 / ${r.budget}
  </div>
  <div class="budget-info" id="info-${r.id}">
    Budget base: ${r.budget}
  </div>
`;

          document.body.appendChild(container);

          const tbody = container.querySelector("tbody");

          for (let i = 1; i <= r.n; i++) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
        <td>${i}</td>
        <td><input type="text" class="player-input" placeholder="Nome giocatore"></td>
        <td><input type="number" class="price-input" min="0" value="0" onchange="aggiornaBudget()"></td>
        <td>
          <button class="remove-player-btn" onclick="rimuoviGiocatore(this)">
            <i class="fas fa-times-circle"></i>
          </button>
        </td>
      `;
            tbody.appendChild(tr);
          }
        });
      }

      function rimuoviGiocatore(btn) {
        const tr = btn.closest("tr");
        tr.querySelector(".player-input").value = "";
        tr.querySelector(".price-input").value = 0;
        aggiornaBudget();
      }

      function aggiornaBudgetTotale() {
        budgetIniziale =
          parseInt(document.getElementById("budgetTotaleInput").value) || 1000;
        aggiornaBudget();
      }

      function aggiornaBudget() {
        let totaleSpeso = 0,
          rollover = 0;
        reparti.forEach((r) => {
          const prezzi = document.querySelectorAll(`#${r.id} .price-input`);
          let speso = 0;
          prezzi.forEach((i) => (speso += parseInt(i.value) || 0));

          // Prendi il budget attuale dall'input, così il budget base si aggiorna
          const inputBudget = document.getElementById(`budget-${r.id}`);
          let budgetEffettivo = parseInt(inputBudget.value) || 0;

          // Aggiorna il budget base visibile
          const infoBox = document.getElementById(`info-${r.id}`);
          infoBox.textContent = `Budget base: ${budgetEffettivo}`;

          // Colori come prima
          let colore = "verde",
            mess = "";
          if (speso > budgetEffettivo) {
            colore = "rosso";
            mess = ` (Sforato di ${speso - budgetEffettivo})`;
          } else if (speso >= budgetEffettivo * 0.9) {
            colore = "giallo";
          } else if (speso < budgetEffettivo) {
            colore = "blu";
            mess = ` (Residuo: ${r.budget + rollover})`;
          }

          const box = document.getElementById(`tot-${r.id}`);
          box.className = `tot-reparto ${colore}`;
          box.innerHTML = `
  Totale ${r.nome}: ${speso} / ${budgetEffettivo}${mess}
  <div style="font-size: 12px; color: #666; margin-top:4px;">
    ${
      rollover > 0
        ? `(da reparto precedente: ${rollover} → totale effettivo: ${
            r.budget + rollover
          })`
        : `(Residuo budget: ${budgetEffettivo - speso})`
    }
  </div>

`;

          box.className = `tot-reparto ${colore}`;

          rollover = budgetEffettivo - speso;
          totaleSpeso += speso;
        });

        const rim = document.getElementById("budgetRimanente");
        rim.textContent = budgetIniziale - totaleSpeso;
        rim.style.color =
          budgetIniziale - totaleSpeso < 0 ? "#dc3545" : "#2e8b57";

        const totRipartito = reparti.reduce(
          (a, r) =>
            a + parseInt(document.getElementById(`budget-${r.id}`).value || 0),
          0
        );
        const ripBox = document.getElementById("budgetRipartito");
        ripBox.textContent = `Ripartizione: ${totRipartito} / ${budgetIniziale}`;
        if (totRipartito > budgetIniziale) {
          ripBox.style.background = "#f8d7da";
          ripBox.style.color = "#721c24";
        } else {
          ripBox.style.background = "rgba(255,255,255,0.1)";
          ripBox.style.color = "white";
        }
      }

      function aggiornaBudgetReparto(id) {
        const val =
          parseInt(document.getElementById(`budget-${id}`).value) || 0;
        const r = reparti.find((x) => x.id === id);
        r.budget = val;
        aggiornaBudget();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const editRepartiBtn = document.getElementById("editRepartiBtn");
        editRepartiBtn.addEventListener("click", () => {
          const inputs = reparti.map((r) =>
            document.getElementById(`budget-${r.id}`)
          );
          if (inputs[0].disabled) {
            inputs.forEach((i) => (i.disabled = false));
            editRepartiBtn.innerHTML =
              '<i class="fas fa-check" style="color:#2e8b57"></i>';
          } else {
            inputs.forEach((i) => (i.disabled = true));
            editRepartiBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
            reparti.forEach((r) => aggiornaBudgetReparto(r.id));
          }
        });

        const editTotaleBtn = document.getElementById("editBudgetBtn");
        editTotaleBtn.addEventListener("click", () => {
          const totInput = document.getElementById("budgetTotaleInput");
          if (totInput.disabled) {
            totInput.disabled = false;
            totInput.focus();
            editTotaleBtn.innerHTML =
              '<i class="fas fa-check" style="color:#2e8b57"></i>';
          } else {
            totInput.disabled = true;
            editTotaleBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
            aggiornaBudgetTotale();
          }
        });
      });

      generaTabelle();
      aggiornaBudget();

      const budgetSelect = document.getElementById("budgetTotaleSelect");
      budgetSelect.addEventListener("change", () => {
        budgetIniziale = parseInt(budgetSelect.value);
        aggiornaBudget();
      });
    </script>
  </body>
</html>
